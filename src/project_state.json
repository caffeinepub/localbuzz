{
  "schemaVersion": "1.0.0",
  "projectStateVersion": 25,
  "summary": "LocalBuzz mobile app with OTP login for Shop Owners and Customers, role selection after login, routing to Shop Dashboard or Customer Home Feed, clean UI, location permission, a Shop Owner registration flow that creates a Shop record linked to the owner user ID, a Shop Owner 'Post Update' feature that creates expiring shop updates with optional image and attached shop location stored in a ShopUpdates collection, a Customer Home Feed that requests location, detects GPS, and lists nearby ShopUpdates within a 3 km radius sorted by newest then closest distance with post cards showing shop name, distance, title, optional image, and expiry status, plus push notifications to customers for new nearby ShopUpdates (3 km) showing shop name + update title with a limit of 3 notifications per shop per day.",
  "architectural_notes": [
    "Two user roles: Shop Owner and Customer.",
    "Authentication via mobile OTP for all users.",
    "After OTP login, user selects role and is routed accordingly (Shop Dashboard or Customer Home Feed).",
    "App requires location permission.",
    "Phone number input/OTP login should default to India country code (+91).",
    "Add a 'Shops' data model/table/collection to store Shop Owner registration details (shop name, category, address, latitude/longitude, image URL/path) and link each shop record to the owning user ID.",
    "Add a 'ShopUpdates' data model/table/collection storing shop updates: shopId, title, optional description, optional image URL/path, expiryDate, created timestamp, and shop location (lat/long) auto-attached to each post.",
    "Customer Home Feed: fetch ShopUpdates within a 3 km radius of the user’s current GPS location; sort by newest first then closest distance; show shop name, distance, title, optional image, and expiry status on each card.",
    "Customer Home Feed: add a top-of-feed category filter (Grocery/Clothing/Electronics/Medical/Food/Other) that filters the visible nearby ShopUpdates by the originating shop’s category.",
    "Push notifications: notify customers when a new ShopUpdate is posted within 3 km; payload shows Shop Name + Update Title; rate limit to max 3 notifications per shop per day."
  ],
  "known_issues": [
    "OTP login phone number country code is incorrect; should be India (+91).",
    "Users are not receiving OTP SMS on their phone numbers during login.",
    "Location permission is being denied (location access request/handling is not working as expected).",
    "App generation/build failed when attempting to create the Shop Dashboard (needs retry/fix).",
    "App generation/build failed when attempting to create the Customer Home Feed (needs retry/fix).",
    "Role selection screen buttons ('Continue as Shop Owner' / 'Continue as Customer') are not opening/navigating (tap/click has no effect)."
  ],
  "isFixRequest": true,
  "existing_features": [
    {
      "id": "feature-create-the-basic-localbuzz-app-structure-with-mobile-first-navigation-and-three-primary-flows-screens-1-login-2-role-selection-shop-owner-vs-customer-and-3-post-login-destinations-shop-dashboard-and-customer-home-feed",
      "title": "Create the basic LocalBuzz app structure with mobile-first navigation and three primary flows/screens: (1) Login, (2) Role Selection (Shop Owner vs Customer), and (3) post-login destinations: Shop Dashboard and Customer Home Feed.",
      "reqIds": [
        "REQ-1"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-a-phone-number-otp-style-login-flow-for-both-user-types-collect-a-phone-number-request-an-otp-then-verify-the-otp-to-create-an-authenticated-session-for-the-current-principal",
      "title": "Implement a phone-number OTP-style login flow for both user types: collect a phone number, request an OTP, then verify the OTP to create an authenticated session for the current principal.",
      "reqIds": [
        "REQ-2"
      ],
      "version": 1
    },
    {
      "id": "feature-request-location-access-permission-on-the-client-and-when-granted-capture-the-user-s-current-coordinates-display-basic-location-status-in-the-ui-and-optionally-persist-the-last-known-location-to-the-backend-user-profile",
      "title": "Request location access permission on the client and, when granted, capture the user’s current coordinates; display basic location status in the UI and optionally persist the last known location to the backend user profile.",
      "reqIds": [
        "REQ-4"
      ],
      "version": 1
    },
    {
      "id": "feature-apply-a-clean-simple-consistent-visual-theme-for-localbuzz-across-all-screens-mobile-first-layout-typography-spacing-and-a-distinct-color-palette-that-is-not-blue-purple",
      "title": "Apply a clean, simple, consistent visual theme for LocalBuzz across all screens (mobile-first layout, typography, spacing, and a distinct color palette that is not blue & purple).",
      "reqIds": [
        "REQ-5"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-otp-login-phone-number-input-to-use-india-as-the-default-country-code-91-and-ensure-the-stored-returned-phone-number-is-normalized-to-an-india-91-e-164-style-value-before-continuing-the-login-flow",
      "title": "Update the OTP login phone number input to use India as the default country code (+91) and ensure the stored/returned phone number is normalized to an India (+91) E.164-style value before continuing the login flow.",
      "reqIds": [
        "REQ-6"
      ],
      "version": 1
    },
    {
      "id": "feature-replace-the-current-simulated-otp-flow-which-does-not-send-any-sms-with-a-functional-otp-challenge-flow-that-lets-the-user-obtain-an-otp-code-inside-the-app-and-verify-it-so-the-login-can-proceed-reliably-even-without-sms-delivery",
      "title": "Replace the current simulated OTP flow (which does not send any SMS) with a functional OTP challenge flow that lets the user obtain an OTP code inside the app and verify it, so the login can proceed reliably even without SMS delivery.",
      "reqIds": [
        "REQ-7"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-otp-ui-copy-and-states-in-the-login-card-to-match-the-actual-behavior-no-claim-that-an-sms-was-sent-and-add-a-clear-resend-code-action-on-the-otp-entry-step",
      "title": "Update the OTP UI copy and states in the login card to match the actual behavior (no claim that an SMS was sent), and add a clear 'Resend code' action on the OTP entry step.",
      "reqIds": [
        "REQ-8"
      ],
      "version": 1
    },
    {
      "id": "feature-harden-otp-input-validation-and-error-handling-so-common-user-mistakes-are-handled-clearly-wrong-length-non-numeric-wrong-code-expired-code-and-do-not-accidentally-authenticate-the-user",
      "title": "Harden OTP input validation and error handling so common user mistakes are handled clearly (wrong length, non-numeric, wrong code, expired code) and do not accidentally authenticate the user.",
      "reqIds": [
        "REQ-9"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-location-permission-hook-to-correctly-detect-and-reflect-the-browser-s-actual-geolocation-permission-state-on-load-and-after-user-actions-instead-of-defaulting-to-a-generic-denied-error-state",
      "title": "Update the location permission hook to correctly detect and reflect the browser’s actual geolocation permission state on load and after user actions, instead of defaulting to a generic 'denied' error state.",
      "reqIds": [
        "REQ-10"
      ],
      "version": 1
    },
    {
      "id": "feature-improve-error-handling-for-geolocation-failures-so-users-can-reliably-recover-distinguish-permission-denial-vs-timeout-vs-position-unavailable-provide-clear-english-error-messages-and-allow-retry-flows-from-the-ui",
      "title": "Improve error handling for geolocation failures so users can reliably recover: distinguish permission denial vs timeout vs position unavailable, provide clear English error messages, and allow retry flows from the UI.",
      "reqIds": [
        "REQ-11"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-locationstatuscard-ui-to-support-the-improved-permission-states-and-recovery-actions-including-showing-an-enable-retry-control-when-permission-is-denied-and-displaying-guidance-text-appropriate-to-each-error-state",
      "title": "Update the LocationStatusCard UI to support the improved permission states and recovery actions, including showing an enable/retry control when permission is denied and displaying guidance text appropriate to each error state.",
      "reqIds": [
        "REQ-12"
      ],
      "version": 1
    },
    {
      "id": "feature-add-a-visible-back-navigation-control-on-every-top-level-page-route-in-the-localbuzz-app-login-role-selection-shop-dashboard-customer-home-positioned-consistently-in-the-page-header-area-using-english-user-facing-text-e-g-an-accessible-icon-button-with-an-aria-label-like-back-the-back-control-must-navigate-to-the-previous-in-app-route-when-possible-and-must-not-break-authentication-session-state",
      "title": "Add a visible Back navigation control on every top-level page/route in the LocalBuzz app (Login, Role Selection, Shop Dashboard, Customer Home), positioned consistently in the page header area, using English user-facing text (e.g., an accessible icon button with an aria-label like \"Back\"). The Back control must navigate to the previous in-app route when possible and must not break authentication/session state.",
      "reqIds": [
        "REQ-13"
      ],
      "version": 1
    },
    {
      "id": "feature-create-a-shop-owner-registration-page-containing-a-form-with-the-following-fields-and-controls-shop-name-text-category-dropdown-grocery-clothing-electronics-medical-food-other-shop-address-text-textarea-auto-detected-gps-location-latitude-longitude-displayed-and-shop-image-upload-file-picker-with-preview",
      "title": "Create a Shop Owner registration page containing a form with the following fields and controls: Shop Name (text), Category (dropdown: Grocery, Clothing, Electronics, Medical, Food, Other), Shop Address (text/textarea), auto-detected GPS location (latitude & longitude displayed), and Shop Image upload (file picker with preview).",
      "reqIds": [
        "REQ-15"
      ],
      "version": 1
    },
    {
      "id": "feature-wire-the-shop-registration-ui-to-backend-apis-using-react-query-hooks-including-loading-success-and-error-handling-and-ensure-the-created-shop-is-persisted-and-can-be-reloaded-for-the-same-owner",
      "title": "Wire the Shop registration UI to backend APIs using React Query hooks, including loading, success, and error handling, and ensure the created Shop is persisted and can be reloaded for the same owner.",
      "reqIds": [
        "REQ-16"
      ],
      "version": 1
    },
    {
      "id": "feature-add-navigation-from-the-shop-dashboard-to-the-shop-registration-page-so-a-shop-owner-can-access-the-registration-form-from-the-main-shop-flow",
      "title": "Add navigation from the Shop Dashboard to the Shop registration page so a Shop Owner can access the registration form from the main Shop flow.",
      "reqIds": [
        "REQ-17"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-shop-dashboard-page-to-match-the-requested-simple-layout-by-adding-1-a-primary-button-labeled-post-update-2-a-toggle-control-to-mark-the-shop-as-open-or-closed-3-a-section-titled-my-active-posts-and-4-a-section-titled-expired-posts",
      "title": "Update the Shop Dashboard page to match the requested simple layout by adding: (1) a primary button labeled \"Post Update\", (2) a toggle control to mark the shop as \"Open\" or \"Closed\", (3) a section titled \"My Active Posts\", and (4) a section titled \"Expired Posts\".",
      "reqIds": [
        "REQ-18"
      ],
      "version": 1
    },
    {
      "id": "feature-ensure-the-shop-dashboard-still-supports-the-existing-shop-registration-edit-entrypoint-when-the-caller-has-no-shop-record-show-a-clear-cta-to-register-when-a-shop-exists-allow-navigating-to-the-shop-registration-page-to-edit",
      "title": "Ensure the Shop Dashboard still supports the existing shop registration/edit entrypoint: when the caller has no shop record, show a clear CTA to register; when a shop exists, allow navigating to the shop registration page to edit.",
      "reqIds": [
        "REQ-19"
      ],
      "version": 1
    },
    {
      "id": "feature-for-my-active-posts-and-expired-posts-sections-implement-simple-empty-states-english-text-when-there-are-no-items-without-adding-backend-persistence-yet",
      "title": "For \"My Active Posts\" and \"Expired Posts\" sections, implement simple empty states (English text) when there are no items, without adding backend persistence yet.",
      "reqIds": [
        "REQ-20"
      ],
      "version": 1
    },
    {
      "id": "feature-create-a-shop-owner-post-update-ui-flow-when-the-shop-owner-taps-post-update-from-the-shop-dashboard-navigate-to-a-new-page-containing-a-form-with-fields-title-short-text-description-optional-optional-image-upload-with-preview-and-expiry-option-today-2-days-custom-date",
      "title": "Create a Shop Owner \"Post Update\" UI flow: when the Shop Owner taps \"Post Update\" from the Shop Dashboard, navigate to a new page containing a form with fields Title (short text), Description (optional), Optional Image upload (with preview), and Expiry option (Today / 2 Days / Custom Date).",
      "reqIds": [
        "REQ-23"
      ],
      "version": 1
    },
    {
      "id": "feature-wire-the-post-update-form-to-backend-apis-using-react-query-on-submit-create-a-shopupdate-show-loading-state-show-a-success-confirmation-in-english-and-navigate-back-to-the-shop-dashboard-or-otherwise-reset-the-form-after-success",
      "title": "Wire the Post Update form to backend APIs using React Query: on submit, create a ShopUpdate, show loading state, show a success confirmation in English, and navigate back to the Shop Dashboard (or otherwise reset the form) after success.",
      "reqIds": [
        "REQ-24"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-shop-dashboard-to-display-real-data-in-my-active-posts-and-expired-posts-sections-by-fetching-shopupdates-for-the-caller-keep-the-existing-english-empty-states-when-there-are-no-items",
      "title": "Update the Shop Dashboard to display real data in \"My Active Posts\" and \"Expired Posts\" sections by fetching ShopUpdates for the caller; keep the existing English empty states when there are no items.",
      "reqIds": [
        "REQ-25"
      ],
      "version": 1
    },
    {
      "id": "feature-ensure-expiry-date-selection-is-correctly-converted-to-a-backend-timestamp-today-end-of-day-or-within-same-day-2-days-now-2-days-and-custom-date-user-selected-date",
      "title": "Ensure Expiry Date selection is correctly converted to a backend timestamp: Today (end of day or within same day), 2 Days (now + 2 days), and Custom Date (user-selected date).",
      "reqIds": [
        "REQ-26"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-customer-home-feed-behavior-on-the-frontend-so-that-when-the-customer-home-feed-route-opens-the-app-requests-location-permission-and-fetches-the-user-s-gps-coordinates-once-coordinates-are-available-fetch-active-shopupdates-and-filter-to-those-within-a-3-km-radius-of-the-user",
      "title": "Implement Customer Home Feed behavior on the frontend so that when the Customer Home Feed route opens, the app requests location permission and fetches the user’s GPS coordinates; once coordinates are available, fetch active ShopUpdates and filter to those within a 3 km radius of the user.",
      "reqIds": [
        "REQ-28"
      ],
      "version": 1
    },
    {
      "id": "feature-render-the-customer-home-feed-list-of-nearby-shopupdates-as-post-cards-sorted-by-1-newest-first-and-2-closest-distance-and-display-the-required-fields-on-each-card-shop-name-distance-title-optional-image-and-expiry-status",
      "title": "Render the Customer Home Feed list of nearby ShopUpdates as post cards sorted by (1) newest first and (2) closest distance, and display the required fields on each card: Shop Name, Distance, Title, optional Image, and Expiry status.",
      "reqIds": [
        "REQ-29"
      ],
      "version": 1
    },
    {
      "id": "feature-add-a-category-filter-control-at-the-top-of-the-customer-home-feed-page-with-selectable-options-grocery-clothing-electronics-medical-food-other-when-a-category-is-selected-show-only-nearby-updates-from-that-category-when-no-category-is-selected-show-all-nearby-updates",
      "title": "Add a category filter control at the top of the Customer Home Feed page with selectable options: Grocery, Clothing, Electronics, Medical, Food, Other. When a category is selected, show only nearby updates from that category; when no category is selected, show all nearby updates.",
      "reqIds": [
        "REQ-31"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-customer-home-feed-query-hook-so-it-can-filter-results-by-an-optional-selected-category-while-preserving-existing-distance-filtering-3-km-and-sorting-newest-first-then-closest",
      "title": "Update the customer home feed query hook so it can filter results by an optional selected category while preserving existing distance filtering (3 km) and sorting (newest first, then closest).",
      "reqIds": [
        "REQ-32"
      ],
      "version": 1
    },
    {
      "id": "feature-add-a-customer-facing-notification-permission-and-status-ui-on-the-customer-home-feed-page-that-allows-the-customer-to-enable-browser-notifications-for-localbuzz-and-clearly-shows-whether-notifications-are-enabled-blocked-unsupported",
      "title": "Add a customer-facing notification permission and status UI on the Customer Home Feed page that allows the customer to enable browser notifications for LocalBuzz and clearly shows whether notifications are enabled/blocked/unsupported.",
      "reqIds": [
        "REQ-33"
      ],
      "version": 1
    },
    {
      "id": "feature-trigger-a-browser-notification-for-customers-when-a-newly-created-shopupdate-appears-within-the-customer-s-3-km-feed-radius-with-the-notification-content-formatted-as-shop-name-update-title",
      "title": "Trigger a browser notification for customers when a newly created ShopUpdate appears within the customer’s 3 km feed radius, with the notification content formatted as \"{Shop Name} — {Update Title}\".",
      "reqIds": [
        "REQ-34"
      ],
      "version": 1
    },
    {
      "id": "feature-enforce-a-client-side-notification-rate-limit-of-maximum-3-notifications-per-shop-per-day-for-customer-notifications-about-new-nearby-shopupdates",
      "title": "Enforce a client-side notification rate limit of maximum 3 notifications per shop per day for customer notifications about new nearby ShopUpdates.",
      "reqIds": [
        "REQ-35"
      ],
      "version": 1
    },
    {
      "id": "feature-fix-the-role-selection-page-so-tapping-clicking-continue-as-shop-owner-or-continue-as-customer-always-performs-a-visible-action-and-navigates-to-the-correct-route-shop-dashboard-or-customer-home-instead-of-appearing-to-do-nothing",
      "title": "Fix the Role Selection page so tapping/clicking \"Continue as Shop Owner\" or \"Continue as Customer\" always performs a visible action and navigates to the correct route (/shop-dashboard or /customer-home) instead of appearing to do nothing.",
      "reqIds": [
        "REQ-36"
      ],
      "version": 1
    },
    {
      "id": "feature-add-robust-handling-on-the-role-selection-page-for-missing-otp-session-phone-number-localstorage-cleared-etc-show-an-english-message-explaining-the-session-is-incomplete-and-route-the-user-back-to-the-login-page-to-re-verify-otp",
      "title": "Add robust handling on the Role Selection page for missing OTP session phone number (localStorage cleared, etc.): show an English message explaining the session is incomplete and route the user back to the login page to re-verify OTP.",
      "reqIds": [
        "REQ-37"
      ],
      "version": 1
    },
    {
      "id": "feature-ensure-role-selection-does-not-block-navigation-on-a-backend-profile-save-failure-if-saving-the-profile-fails-still-route-the-user-to-the-selected-destination-and-show-an-english-non-blocking-warning-that-profile-sync-failed-and-can-be-retried-later",
      "title": "Ensure Role Selection does not block navigation on a backend profile-save failure: if saving the profile fails, still route the user to the selected destination and show an English non-blocking warning that profile sync failed and can be retried later.",
      "reqIds": [
        "REQ-38"
      ],
      "version": 1
    },
    {
      "id": "feature-fix-the-role-selection-auto-redirect-logic-so-it-does-not-incorrectly-force-users-to-customer-home-on-load-regardless-of-their-intent-only-auto-redirect-when-a-previously-chosen-role-is-unambiguous-otherwise-keep-the-user-on-the-role-selection-screen",
      "title": "Fix the Role Selection auto-redirect logic so it does not incorrectly force users to /customer-home on load regardless of their intent; only auto-redirect when a previously chosen role is unambiguous, otherwise keep the user on the Role Selection screen.",
      "reqIds": [
        "REQ-39"
      ],
      "version": 1
    }
  ],
  "new_feature_requests": [
    {
      "id": "AR-1",
      "summary": "Create basic LocalBuzz app structure with clean, simple UI",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-2",
      "summary": "Implement mobile OTP login flow for both Shop Owner and Customer users",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-3",
      "summary": "Post-login role selection (Shop Owner vs Customer) and redirect to Shop Dashboard or Customer Home Feed",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-4",
      "summary": "Request and use location access permission in the app",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-7",
      "summary": "Persist a minimal user profile in the backend keyed to the authenticated principal, including phone number, selected role (Shop Owner or Customer), and timestamps; expose APIs to read/update the current user profile.",
      "reqIds": [
        "REQ-3"
      ],
      "status": "pending"
    },
    {
      "id": "AR-8",
      "summary": "Add a back button option on every screen/page throughout the app for consistent navigation",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-9",
      "summary": "Shop Owner registration form to create a Shop (name, category dropdown, address, auto-detected GPS lat/long, image upload) saved under 'Shops' and linked to the owner's user ID",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-10",
      "summary": "Add backend support for a new \"Shops\" collection that stores Shop Owner registration data (shop name, category, address, GPS latitude/longitude, and a shop image) and links each Shop record to the authenticated owner user ID (caller Principal).",
      "reqIds": [
        "REQ-14"
      ],
      "status": "pending"
    },
    {
      "id": "AR-11",
      "summary": "Create Shop Dashboard UI with Post Update button, Open/Closed toggle, My Active Posts section, and Expired Posts section (simple layout)",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-12",
      "summary": "Implement Shop Owner 'Post Update' flow: open a form (title, optional description, optional image, expiry Today/2 Days/Custom Date), auto-attach shop location, and save to a ShopUpdates collection with shopId, fields, expiry date, timestamp, and lat/long.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-13",
      "summary": "Add backend support for a new \"ShopUpdates\" collection that persists shop owner posts with the following fields: Shop ID, Title, Description (optional), Image (optional), Expiry Date, Timestamp, and Shop Location (latitude, longitude).",
      "reqIds": [
        "REQ-21"
      ],
      "status": "pending"
    },
    {
      "id": "AR-14",
      "summary": "Implement backend APIs to create and fetch ShopUpdates for the current shop owner, ensuring each created update automatically attaches the shop’s registered location (latitude/longitude) to the post.",
      "reqIds": [
        "REQ-22"
      ],
      "status": "pending"
    },
    {
      "id": "AR-15",
      "summary": "Create Customer Home Feed that requests location on app open, detects GPS, and shows nearby ShopUpdates within 3 km sorted by newest first then closest; each card shows Shop Name, distance, title, optional image, and expiry status.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-16",
      "summary": "Update the backend to support the Customer Home Feed by exposing a query API that returns active ShopUpdates enriched with the originating shop’s name (and the updateId), so the frontend can render a nearby feed without making per-item shop lookup calls.",
      "reqIds": [
        "REQ-27"
      ],
      "status": "pending"
    },
    {
      "id": "AR-17",
      "summary": "Add a category filter control at the top of the Customer Home Feed (Grocery, Clothing, Electronics, Medical, Food, Other) to show only ShopUpdates from the selected shop category.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-18",
      "summary": "Extend the Customer Home Feed backend API to include each update's shop category so the frontend can filter feed items by category.",
      "reqIds": [
        "REQ-30"
      ],
      "status": "pending"
    },
    {
      "id": "AR-19",
      "summary": "Enable push notifications to customers for new ShopUpdates within 3 km radius; notification shows Shop Name + Update Title; limit to max 3 notifications per shop per day.",
      "reqIds": [],
      "status": "pending"
    }
  ],
  "gameProjectType": "none",
  "projectName": "LocalBuzz",
  "clarification_mode": "instant",
  "clarification_rounds": 0
}