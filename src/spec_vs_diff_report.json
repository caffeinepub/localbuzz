{
  "kind": "spec_vs_diff_report",
  "version": "1.0",
  "generatedAt": "2026-02-14T07:44:46.800Z",
  "summary": "Diff adds an `expiredAt` field to the ShopUpdate model and a migration to backfill existing records with `expiredAt = null`. It also introduces an `expireShopUpdates()` function (called on `postupgrade`) to mark some updates inactive and set `expiredAt`, but there is no clear evidence of a 10-minute scheduled process or of feed APIs filtering out expired updates as required.",
  "missing_requirements": [
    {
      "id": "REQ-1",
      "requirement": "Add a backend scheduled process that runs every 10 minutes and automatically expires ShopUpdates (isActive == true and expiryDate <= current time) by setting isActive=false and expiredAt=current timestamp, without deleting records.",
      "reason": "The diff shows `expireShopUpdates()` being invoked from `system func postupgrade()` only; there is no evidence of a recurring timer/scheduler that runs every 10 minutes. Additionally, the shown expiry condition uses `currentTime > shopUpdate.expiryDate` rather than `expiryDate <= currentTime`.",
      "evidence": [
        "backend/main.mo"
      ]
    },
    {
      "id": "REQ-3",
      "requirement": "Ensure all backend APIs used for customer-facing feeds only return currently active, unexpired ShopUpdates (isActive == true AND expiryDate > current time).",
      "reason": "The diff snippet defines `FeedShopUpdate` and adds expiry logic in `expireShopUpdates()`, but does not show any modifications to the customer feed query methods to filter on `(isActive == true AND expiryDate > now)` at query time.",
      "evidence": [
        "backend/main.mo"
      ]
    }
  ],
  "hallucinated_features": [
    {
      "description": "Expire ShopUpdates during canister `postupgrade` by calling `expireShopUpdates()`.",
      "reason": "REQ-1 asks for a scheduled process running every 10 minutes; running expiry on `postupgrade` is not specified as a requirement (even if it may be useful).",
      "evidence": [
        "backend/main.mo"
      ]
    }
  ],
  "confidence": 0.68,
  "changed_files": [
    "backend/main.mo",
    "backend/migration.mo",
    "project_state.json"
  ]
}